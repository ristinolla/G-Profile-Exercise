var app=angular.module("profileApp",[]);app.service("ApiService",function(e,n){function t(n){var t=e({method:"post",url:"/api/connect?state="+STATE,data:n.code,contentType:"application/octet-stream; charset=utf-8"});return t.then(c,i)}function o(n){console.log("disconnect in services");var t=e({method:"post",url:"/api/disconnect",data:{token:n.code},contentType:"application/octet-stream; charset=utf-8"});return t.then(c,i)}function i(e){return n.reject(angular.isObject(e.data)&&e.data.message?e.data.message:"An unknown error occurred.")}function c(e){return console.log(e.data),e.data}return{connect:t,disconnect:o}}),app.controller("OauthCtrl",function(e,n,t){e.isSignedIn=!1,e.immediateFailed=!1,e.authResult={},e.data={callback:e.signIn,clientid:"391956554891-0spjspmirtm07e9l9tsjl1ntkdpcmle5.apps.googleusercontent.com",requestvisibleactions:"http://schemas.google.com/AddActivity",scope:"https://www.googleapis.com/auth/plus.login",theme:"dark",cookiepolicy:"single_host_origin",accesstype:"offline"},e.signedIn=function(){e.isSignedIn=!0,console.log("Signed In")},e.sendSignIn=function(e){return n.post("/api/connect",e)},e.signIn=function(n){e.$apply(function(){e.authResult=n,console.log("Authresult: ",n),e.processAuth(n)})},e.processAuth=function(n){return e.immediateFailed=!0,e.isSignedIn?0:void(n.access_token?(e.immediateFailed=!1,t.connect(n).then(function(n){e.signedIn(n.data)},function(e){console.log("Connection failed because: ",e)})):n.error&&("immediate_failed"===n.error?(console.log("Immediate Connection failed"),e.immediateFailed=!0):console.log("Error:"+n.error)))},e.renderSignIn=function(){return gapi.signin.render("myGsignin",{callback:e.signIn,clientid:"391956554891-0spjspmirtm07e9l9tsjl1ntkdpcmle5.apps.googleusercontent.com",requestvisibleactions:"http://schemas.google.com/AddActivity",scope:"https://www.googleapis.com/auth/plus.login",theme:"dark",cookiepolicy:"single_host_origin",accesstype:"offline"})},e.signOut=function(){console.log("signOut in controller",e.authResult),t.disconnect(e.authResult)}});