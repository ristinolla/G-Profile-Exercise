var app=angular.module("profileApp",["ngRoute","loginControllers","profileControllers","peopleController"]);app.run(["$rootScope",function(e){e.authresult=!1}]),app.config(["$routeProvider",function(e){e.when("/profile",{templateUrl:"views/profile.html",controller:"ProfileCtrl"}).when("/people",{templateUrl:"views/people.html",controller:"PeopleCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).otherwise({redirectTo:"/login"})}]),app.service("ApiService",function(e,t){function n(e){return t.reject(angular.isObject(e.data)&&e.data.message?e.data.message:e.data)}function o(e){return e.data}var r={};return r.connect=function(t){var r=e({method:"post",url:"/api/connect?state="+STATE,data:t.code,contentType:"application/octet-stream; charset=utf-8"});return r.then(o,n)},r.disconnect=function(t){var r=e({method:"post",url:"/api/disconnect",data:{token:t.code},contentType:"application/octet-stream; charset=utf-8"});return r.then(o,n)},r.getProfile=function(){var t=e({method:"get",url:"/api/profile",contentType:"application/octet-stream; charset=utf-8"});return t.then(o,n)},r.getPeople=function(){var t=e({method:"get",url:"/api/people",contentType:"application/octet-stream; charset=utf-8"});return t.then(o,n)},r}),app.factory("OauthService",function(e,t,n){var o={};return o.isSignedIn=!1,o.processAuth=function(e){var o=t.defer();return this.isSignedIn&&o.resolve({signedIn:!0,message:"Already signed in."}),e.access_token?(this.immediateFailed=!1,n.connect(e).then(function(e){console.log("Login succesfull, status: ",e),o.resolve({signedIn:!0,message:e})},function(e){console.log("Connection failed because: ",e),o.resolve({signedIn:!1,message:e})})):e.error&&("immediate_failed"===e.error?(this.immediateFailed=!0,o.resolve({signedIn:!1,message:"Immediate Connection failed"})):(console.log("severe amount of shit in the fan"),o.resolve({signedIn:!1,message:e.error}))),o.promise},o.disconnect=function(e){var o=t.defer();return n.disconnect(e).then(function(e){this.isSignedIn=!1,o.resolve({signedOut:!0,message:e})}),o.promise},o});var loginControllers=angular.module("loginControllers",[]);loginControllers.controller("LoginCtrl",function(e,t,n,o,r){var i=function(){console.log("rootscopeauth: ",r.authResult),r.authResult?e.authResult.status.signed_in&&(r.isSignedIn=!0):r.isSignedIn=!1};i();var l=function(n){return r.authResult=n,"AUTO"===n.status.method&&n.status.signed_in&&n.status.google_logged_in?void t.path("/profile"):"PROMPT"===n.status.method?r.authResult?void e.$apply(function(){o.processAuth(r.authResult).then(function(n){console.log(n),n.signedIn===!0?(e.isSignedIn=!0,t.path("/profile")):(e.isSignedIn=!1,console.log(n.message))})}):void(e.signedIn=!1):void 0};e.login=function(){var e={callback:l};gapi.auth.signIn(e)}});var profileControllers=angular.module("profileControllers",[]);profileControllers.controller("ProfileCtrl",function(e,t,n,o,r){function i(e){var t=e.placesLived;if("undefined"==typeof t)return!1;for(var n in t)if(t[n].primary)return t[n].value;return void 0}e.profile={},e.people={};var l=function(){t.getProfile().then(function(t){e.profile=t,e.profile.image.bigUrl=t.image.url.split("?")[0],e.profile.homeTown=i(e.profile),a()},function(){o.path("/login")}),t.getPeople().then(function(t){e.people=t},function(){})};l();var a=function(){if(e.profile.urls){var t=[{pattern:"twitter",service:"twitter"},{pattern:"linkedin.com",service:"linkedin"},{pattern:"last.fm",service:"lastfm"},{pattern:"facebook",service:"facebook"}];for(var n in e.profile.urls)for(var o in t){var r=e.profile.urls[n].value.indexOf(t[o].pattern);-1!==r&&(e.profile.urls[n].service=t[o].service)}}};e.revealContent=function(e,t){classie.addClass(t.srcElement,"hide"),classie.removeClass(document.getElementById(e),"sneakpeak")},e.disconnect=function(){console.log(r.authResult),n.disconnect(r.authResult).then(function(){gapi.auth.signOut(),r.isSignedIn=!1,o.path("/login")})}});var peopleController=angular.module("peopleController",[]);peopleController.controller("PeopleCtrl",function(e,t,n){e.people={},t.getPeople().then(function(t){e.people=t},function(e){console.log(e),n.path("/login")})});