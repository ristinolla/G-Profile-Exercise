var app=angular.module("profileApp",["ngRoute","loginControllers","profileControllers","peopleController"]);app.run(["$rootScope",function(e){e.authresult=!1}]),app.config(["$routeProvider",function(e){e.when("/profile",{templateUrl:"views/profile.html",controller:"ProfileCtrl"}).when("/people",{templateUrl:"views/people.html",controller:"PeopleCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/logout",{templateUrl:"views/logout.html"}).otherwise({redirectTo:"/login"})}]),app.service("ApiService",function(e,t){function o(e){return t.reject(angular.isObject(e.data)&&e.data.message?e.data.message:e.data)}function n(e){return e.data}var r={};return r.connect=function(t){var r=e({method:"post",url:"/api/connect?state="+STATE,data:t.code,contentType:"application/octet-stream; charset=utf-8"});return r.then(n,o)},r.disconnect=function(t){var r=e({method:"post",url:"/api/disconnect",data:{token:t.code},contentType:"application/octet-stream; charset=utf-8"});return r.then(n,o)},r.getProfile=function(){var t=e({method:"get",url:"/api/profile",contentType:"application/octet-stream; charset=utf-8"});return t.then(n,o)},r.getPeople=function(){var t=e({method:"get",url:"/api/people",contentType:"application/octet-stream; charset=utf-8"});return t.then(n,o)},r}),app.factory("OauthService",function(e,t,o){var n={};return n.isSignedIn=!1,n.processAuth=function(e){var n=t.defer();return this.isSignedIn&&n.resolve({signedIn:!0,message:"Already signed in."}),e.access_token?(this.immediateFailed=!1,o.connect(e).then(function(e){console.log("Login succesfull, status: ",e),n.resolve({signedIn:!0,message:e})},function(e){console.log("Connection failed because: ",e),n.resolve({signedIn:!1,message:e})})):e.error&&("immediate_failed"===e.error?(this.immediateFailed=!0,n.resolve({signedIn:!1,message:"Immediate Connection failed"})):(console.log("severe amount of shit in the fan"),n.resolve({signedIn:!1,message:e.error}))),n.promise},n.disconnect=function(e){var n=t.defer();return o.disconnect(e).then(function(e){this.isSignedIn=!1,n.resolve({signedOut:!0,message:e})}),n.promise},n});var loginControllers=angular.module("loginControllers",[]);loginControllers.controller("LoginCtrl",function(e,t,o,n,r){var i=function(){r.authResult?e.authResult.status.signed_in&&(r.isSignedIn=!0):r.isSignedIn=!1};i();var l=function(o){if(r.authResult=o,"AUTO"===o.status.method&&o.status.signed_in&&o.status.google_logged_in)return void t.path("/profile");if("PROMPT"===o.status.method){if(!r.authResult)return void(e.signedIn=!1);console.log(o),e.$apply(function(){n.processAuth(r.authResult).then(function(o){console.log(o),o.signedIn===!0?(e.isSignedIn=!0,t.path("/profile")):(e.isSignedIn=!1,console.log(o.message))})})}};e.login=function(){var e={callback:l};gapi.auth.signIn(e)}});var profileControllers=angular.module("profileControllers",[]);profileControllers.controller("ProfileCtrl",function(e,t,o,n,r){function i(e){var t=e.placesLived;if("undefined"==typeof t)return!1;for(var o in t)if(t[o].primary)return t[o].value;return void 0}e.profile={},e.people={};var l=function(){t.getProfile().then(function(t){e.profile=t,e.profile.image.bigUrl=t.image.url.split("?")[0],e.profile.homeTown=i(e.profile),e.profile.cover||(e.profile.coverPhoto.url="/assets/img/fallback-cover.jpg",e.profile.coverPhoto.height=600),a()},function(){n.path("/login")}),t.getPeople().then(function(t){e.people=t},function(e){console.log("error fetching people",e)})};l();var a=function(){if(e.profile.urls){var t=[{pattern:"twitter",service:"twitter"},{pattern:"linkedin.com",service:"linkedin"},{pattern:"last.fm",service:"lastfm"},{pattern:"facebook",service:"facebook"}];for(var o in e.profile.urls)for(var n in t){var r=e.profile.urls[o].value.indexOf(t[n].pattern);-1!==r&&(e.profile.urls[o].service=t[n].service)}}};e.revealContent=function(e,t){classie.addClass(t.srcElement,"hide"),classie.removeClass(document.getElementById(e),"sneakpeak")},e.disconnect=function(){console.log(r.authResult),o.disconnect(r.authResult).then(function(){gapi.auth.signOut(),n.path("/logout")})}});var peopleController=angular.module("peopleController",[]);peopleController.controller("PeopleCtrl",function(e,t,o){e.people={},t.getPeople().then(function(t){e.people=t},function(e){console.log(e),o.path("/login")})});