var app=angular.module("profileApp",["ngRoute","loginControllers","profileControllers","peopleController"]);app.run(["$rootScope",function(e){e.authresult=!1}]),app.config(["$routeProvider",function(e){e.when("/profile",{templateUrl:"views/profile.html",controller:"ProfileCtrl"}).when("/people",{templateUrl:"views/people.html",controller:"PeopleCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).otherwise({redirectTo:"/login"})}]),app.service("ApiService",function(e,n){function t(e){return n.reject(angular.isObject(e.data)&&e.data.message?e.data.message:e.data)}function o(e){return e.data}var r={};return r.connect=function(n){var r=e({method:"post",url:"/api/connect?state="+STATE,data:n.code,contentType:"application/octet-stream; charset=utf-8"});return r.then(o,t)},r.disconnect=function(n){var r=e({method:"post",url:"/api/disconnect",data:{token:n.code},contentType:"application/octet-stream; charset=utf-8"});return r.then(o,t)},r.getProfile=function(){var n=e({method:"get",url:"/api/profile",contentType:"application/octet-stream; charset=utf-8"});return n.then(o,t)},r.getPeople=function(){var n=e({method:"get",url:"/api/people",contentType:"application/octet-stream; charset=utf-8"});return n.then(o,t)},r}),app.factory("OauthService",function(e,n,t){var o={};return o.isSignedIn=!1,o.processAuth=function(e){var o=n.defer();return this.isSignedIn&&o.resolve({signedIn:!0,message:"Already signed in."}),e.access_token?(this.immediateFailed=!1,t.connect(e).then(function(e){console.log("Login succesfull, status: ",e),o.resolve({signedIn:!0,message:e})},function(e){console.log("Connection failed because: ",e),o.resolve({signedIn:!1,message:e})})):e.error&&("immediate_failed"===e.error?(this.immediateFailed=!0,o.resolve({signedIn:!1,message:"Immediate Connection failed"})):(console.log("severe amount of shit in the fan"),o.resolve({signedIn:!1,message:e.error}))),o.promise},o.disconnect=function(e){var o=n.defer();return t.disconnect(e).then(function(e){this.isSignedIn=!1,o.resolve({signedOut:!0,message:e})}),o.promise},o});var loginControllers=angular.module("loginControllers",[]);loginControllers.controller("LoginCtrl",function(e,n,t,o,r){var i=function(){console.log("rootscopeauth: ",r.authResult),r.authResult?e.authResult.status.signed_in&&(r.isSignedIn=!0):r.isSignedIn=!1};i();var l=function(t){return e.authResult=t,r.authResult=t,"AUTO"===t.status.method&&t.status.signed_in&&t.status.google_logged_in?(e.isSignedIn=!0,void n.path("/profile")):void("PROMPT"===t.status.method&&e.$apply(function(){o.processAuth(t).then(function(t){console.log(t),t.signedIn===!0?(e.isSignedIn=!0,n.path("/profile")):(e.isSignedIn=!1,console.log(t.message))})}))};e.login=function(){var e={callback:l};gapi.auth.signIn(e)},e.disconnect=function(){o.disconnect(r.authResult).then(function(){gapi.auth.signOut(),r.isSignedIn=!1})}});var profileControllers=angular.module("profileControllers",[]);profileControllers.controller("ProfileCtrl",function(e,n,t,o,r){function i(e){var n=e.placesLived;if("undefined"==typeof n)return!1;for(var t in n)if(n[t].primary)return n[t].value;return void 0}e.profile={},e.people={};var l=function(){n.getProfile().then(function(n){e.profile=n,e.profile.image.bigUrl=n.image.url.split("?")[0],e.profile.homeTown=i(e.profile),a()},function(){o.path("/login")}),n.getPeople().then(function(n){e.people=n},function(){})};l();var a=function(){if(e.profile.urls){var n=[{pattern:"twitter",service:"twitter"},{pattern:"linkedin.com",service:"linkedin"},{pattern:"last.fm",service:"lastfm"},{pattern:"facebook",service:"facebook"}];for(var t in e.profile.urls)for(var o in n){var r=e.profile.urls[t].value.indexOf(n[o].pattern);-1!==r&&(e.profile.urls[t].service=n[o].service)}}};e.revealContent=function(e,n){classie.addClass(n.srcElement,"hide"),classie.removeClass(document.getElementById(e),"sneakpeak")},e.disconnect=function(){console.log(r.authResult),t.disconnect(r.authResult).then(function(){gapi.auth.signOut(),r.isSignedIn=!1,o.path("/login")})}});var peopleController=angular.module("peopleController",[]);peopleController.controller("PeopleCtrl",function(e,n,t){e.people={},n.getPeople().then(function(n){e.people=n},function(e){console.log(e),t.path("/login")})});