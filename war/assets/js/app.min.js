var app=angular.module("profileApp",["ngRoute","profileControllers","peopleController"]);app.config(["$routeProvider",function(e){console.log("Routerprovider started"),e.when("/profile",{templateUrl:"partials/profile-view.html",controller:"ProfileCtrl"}).when("/people",{templateUrl:"partials/people.html",controller:"PeopleCtrl"}).otherwise({redirectTo:"/profile"})}]),app.service("ApiService",function(e,o){function n(e){return o.reject(angular.isObject(e.data)&&e.data.message?e.data.message:e.data)}function t(e){return e.data}var r={};return r.connect=function(o){var r=e({method:"post",url:"/api/connect?state="+STATE,data:o.code,contentType:"application/octet-stream; charset=utf-8"});return r.then(t,n)},r.disconnect=function(o){var r=e({method:"post",url:"/api/disconnect",data:{token:o.code},contentType:"application/octet-stream; charset=utf-8"});return r.then(t,n)},r.getProfile=function(){console.log("ApiService.getProfile");var o=e({method:"get",url:"/api/profile",contentType:"application/octet-stream; charset=utf-8"});return o.then(t,n)},r.getPeople=function(){console.log("ApiService.getPeople");var o=e({method:"get",url:"/api/people",contentType:"application/octet-stream; charset=utf-8"});return o.then(t,n)},r}),app.factory("OauthService",function(e,o,n){var t={};return t.isSignedIn=!1,t.processAuth=function(e){var t=o.defer();return this.isSignedIn&&t.resolve({signedIn:!0,message:"Already signed in."}),e.access_token?(this.immediateFailed=!1,n.connect(e).then(function(e){console.log("Login succesfull, status: ",e),t.resolve({signedIn:!0,message:e})},function(e){console.log("Connection failed because: ",e),t.resolve({signedIn:!1,message:e})})):e.error&&("immediate_failed"===e.error?(this.immediateFailed=!0,t.resolve({signedIn:!1,message:"Immediate Connection failed"})):(console.log("severe amount of shit in the fan"),t.resolve({signedIn:!1,message:e.error}))),t.promise},t.disconnect=function(e){var t=o.defer();return n.disconnect(e).then(function(e){this.isSignedIn=!1,t.resolve({signedOut:!0,message:e})}),t.promise},t});var profileControllers=angular.module("profileControllers",[]);profileControllers.controller("ProfileCtrl",function(e,o,n){function t(e){var o=e.placesLived;if("undefined"==typeof o)return!1;for(var n in o)if(o[n].primary)return o[n].value;return void 0}e.isSignedIn=n.isSignedIn,e.immediateFailed=!1,e.authResult={},e.errorMessage=!1,e.profile={},e.people={},e.showProfile=function(){o.getProfile().then(function(o){console.log("Profile object",o),e.profile=o,e.profile.image.bigUrl=o.image.url.split("?")[0],e.profile.homeTown=t(e.profile),e.urlTypes()}),o.getPeople().then(function(o){console.log("People object",o),e.people=o})},e.disconnect=function(){n.disconnect(e.authResult).then(function(o){gapi.auth.signOut(),console.log(o),e.isSignedIn=!1,e.profile={},e.people={}})},e.signIn=function(o){return"AUTO"===o.status.method&&o.status.signed_in&&o.status.google_logged_in?(console.log("ayto"),e.isSignedIn=!0,void e.showProfile()):void e.$apply(function(){e.authResult=o,n.processAuth(o).then(function(o){console.log(o),o.signedIn===!0?(e.isSignedIn=!0,e.showProfile()):(e.isSignedIn=!1,console.log(o.message))})})},e.login=function(){var o={callback:e.signIn};gapi.auth.signIn(o)},e.revealContent=function(e,o){classie.addClass(o.srcElement,"hide"),classie.removeClass(document.getElementById(e),"sneakpeak")},e.urlTypes=function(){if(e.profile.urls){var o=[{pattern:"twitter",service:"twitter"},{pattern:"linkedin.com",service:"linkedin"},{pattern:"last.fm",service:"lastfm"},{pattern:"facebook",service:"facebook"}];for(var n in e.profile.urls)for(var t in o){var r=e.profile.urls[n].value.indexOf(o[t].pattern);-1!==r&&(e.profile.urls[n].service=o[t].service)}}}});var peopleController=angular.module("peopleController",[]);peopleController.controller("PeopleCtrl",function(e,o){e.people={},o.getPeople().then(function(o){console.log(o),e.people=o})});