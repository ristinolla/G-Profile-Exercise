var app=angular.module("profileApp",["profileControllers"]);app.service("ApiService",function(e,n){function t(e){return n.reject(angular.isObject(e.data)&&e.data.message?e.data.message:e.data)}function o(e){return e.data}var i={};return i.connect=function(n){var i=e({method:"post",url:"/api/connect?state="+STATE,data:n.code,contentType:"application/octet-stream; charset=utf-8"});return i.then(o,t)},i.disconnect=function(n){var i=e({method:"post",url:"/api/disconnect",data:{token:n.code},contentType:"application/octet-stream; charset=utf-8"});return i.then(o,t)},i.getProfile=function(){console.log("ApiService.getProfile");var n=e({method:"get",url:"/api/profile",contentType:"application/octet-stream; charset=utf-8"});return n.then(o,t)},i.getPeople=function(){console.log("ApiService.getPeople");var n=e({method:"get",url:"/api/people",contentType:"application/octet-stream; charset=utf-8"});return n.then(o,t)},i}),app.factory("OauthService",function(e,n,t){var o={};return o.isSignedIn=!1,o.processAuth=function(e){var o=n.defer();return this.isSignedIn&&o.resolve({signedIn:!0,message:"Already signed in."}),e.access_token?(this.immediateFailed=!1,t.connect(e).then(function(e){console.log("Login succesfull, status: ",e),o.resolve({signedIn:!0,message:e})},function(e){console.log("Connection failed because: ",e),o.resolve({signedIn:!1,message:e})})):e.error&&("immediate_failed"===e.error?(this.immediateFailed=!0,o.resolve({signedIn:!1,message:"Immediate Connection failed"})):(console.log("severe amount of shit in the fan"),o.resolve({signedIn:!1,message:e.error}))),o.promise},o.disconnect=function(e){var o=n.defer();return t.disconnect(e).then(function(e){this.isSignedIn=!1,o.resolve({signedOut:!0,message:e})}),o.promise},o});var profileControllers=angular.module("profileControllers",[]);profileControllers.controller("ProfileCtrl",function(e,n,t){e.isSignedIn=t.isSignedIn,e.immediateFailed=!1,e.authResult={},e.errorMessage=!1,e.profile={},e.people={},e.showProfile=function(){n.getProfile().then(function(n){console.log("Profile object",n),e.profile=n,e.profile.image.bigUrl=n.image.url.split("?")[0]}),n.getPeople().then(function(n){console.log("People object",n),e.people=n})},e.disconnect=function(){t.disconnect(e.authResult).then(function(n){gapi.auth.signOut(),console.log(n),e.isSignedIn=!1,e.profile={},e.people={}})},e.signIn=function(n){return"PROMPT"!==n.status.method?void console.log("not promt, but immediate?",n.status):(console.log(n),void e.$apply(function(){e.authResult=n,t.processAuth(n).then(function(n){console.log(n),n.signedIn===!0?(e.isSignedIn=!0,e.showProfile()):(e.isSignedIn=!1,console.log(n.message))})}))},e.login=function(){var n={callback:e.signIn};gapi.auth.signIn(n)}});